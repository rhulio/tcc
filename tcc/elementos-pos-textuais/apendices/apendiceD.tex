\apendice{CÃ³digo: Demanda de Roteadores}
\label{ap:apendice-roteadores}

\begin{lstlisting}[
    basicstyle=\tiny,
]
<?php
    $roteadores = array(
		"237" => "Recepcao",
		"238" => "Auditorio",
		"239" => "Apartamento 204",
		"240" => "Restaurante",
		"241" => "Apartamento 107",
		"242" => "Apartamento 216",
		"243" => "Apartamento 210",
		"244" => "Apartamento 226",
		"245" => "Apartamento 103",
		"246" => "Apartamento 213",
		"247" => "Apartamento 219",
	);

	$doisT = 0;
	$cincoT = 0;
	$downloadT = 0;
	$uploadT = 0;

	for($i = 237; $i < 248; $i++){
		$ip = "10.255.0.{$i}";

		$ch = curl_init();

		curl_setopt($ch, CURLOPT_COOKIEJAR, "cookie-{$ip}.txt");
		curl_setopt($ch, CURLOPT_URL,"http://{$ip}/Main_WStatus2g_Content.asp");
		curl_setopt($ch, CURLOPT_USERPWD, "rhulio:minhasenha");
		curl_setopt($ch, CURLOPT_HEADER, 0);
		curl_setopt($ch, CURLOPT_POST, 0);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($ch, CURLOPT_TIMEOUT, 5);

		$r = curl_exec($ch);
		preg_match_all(
		    "/[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2} /",
		$r, $mac);
		$dois = count($mac[0]);
		$doisT += $dois;

		curl_setopt($ch, CURLOPT_URL,"http://{$ip}/Main_WStatus_Content.asp");
		$r = curl_exec($ch);
		preg_match_all(
		    "/[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2}\:[0-9A-F]{2} /",
		$r, $mac);
		$cinco = count($mac[0]);
		$cincoT += $cinco;

		curl_setopt($ch, CURLOPT_URL,"http://{$ip}/Main_TrafficMonitor_last24.asp");
		$r = curl_exec($ch);

		preg_match("/rx_total\: ([0-9]+)/", $r, $download);
		$download = number_format($download[1]/1073741824, 2, ".", "");
		$downloadT += $download;

		preg_match("/rx_max\: ([0-9]+)/", $r, $downloadS);
		$downloadS = number_format($downloadS[1]/125000, 2, ".", "");

		preg_match("/tx_total\: ([0-9]+)/", $r, $upload);
		$upload = number_format($upload[1]/1073741824, 2, ".", "");
		$uploadT += $upload;
		
		preg_match("/tx_max\: ([0-9]+)/", $r, $uploadS);
		$uploadS = number_format($uploadS[1]/125000, 2, ".", "");

		curl_close($ch);

		$totalAtivos = $dois+$cinco;
		$enviaAtivos = file_get_contents(
		    "http://sistema.rscada.ga/api/C487D2/envio?a{$i}={$totalAtivos}&d{$i}={$download}&u{$i}={$upload}&dl{$i}={$downloadS}&ul{$i}={$uploadS}"
		);

		echo "<strong>{$totalAtivos} ativos - {$dois} / {$cinco} - {$roteadores[$i]}</strong><br />Ultimas 24 horas:<br />{$uploadS} / {$downloadS} Mbps<br />{$upload} / {$download} GB<br /><br />";
\end{lstlisting}